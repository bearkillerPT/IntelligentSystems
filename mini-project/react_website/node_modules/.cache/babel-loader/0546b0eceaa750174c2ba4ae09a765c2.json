{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/pedromarques27/Desktop/IntelligentSystems/mini-project/react_website/src/ChatComponent.js\";\nimport React, { Component } from 'react';\nimport { Comment, Header } from 'semantic-ui-react';\nimport ChatHistory from './ChatHistory';\nimport ChatInput from './ChatInput';\nimport ClientAnalysis from './ComponentAnalysis';\nimport debounce from 'lodash.debounce';\n\nvar ChatComponent = /*#__PURE__*/function (_Component) {\n  _inherits(ChatComponent, _Component);\n\n  function ChatComponent(props) {\n    var _this;\n\n    _classCallCheck(this, ChatComponent);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ChatComponent).call(this, props));\n\n    _this.handleInput = function (input) {\n      input = input.trim();\n      if (!input) return;\n\n      var messages = _this.state.messages.slice(0);\n\n      var client = _this.analyzer.analyze_question(_this.fixup(input));\n\n      messages.push({\n        user: true,\n        text: input,\n        date: new Date()\n      });\n\n      _this.setState({\n        messages: messages,\n        client: client\n      });\n\n      _this.debounced_reply(client.Answer, client['Query']);\n    };\n\n    _this.reply = function (reply, query) {\n      var messages = _this.state.messages.slice(0);\n\n      if (_this.state.messages.length === 0) return;\n      console.log(reply, query);\n\n      if (query) {\n        messages.push({\n          user: false,\n          text: \"Don't worry, we're processing your request!\",\n          date: new Date()\n        });\n\n        _this.setState({\n          messages: messages\n        });\n\n        var changed = false;\n        fetch('http://localhost:3009/api?query=' + query).then( /*#__PURE__*/function () {\n          var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(response) {\n            var data, error;\n            return _regeneratorRuntime.wrap(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    _context.next = 2;\n                    return response.json();\n\n                  case 2:\n                    data = _context.sent;\n\n                    if (response.ok) {\n                      _context.next = 6;\n                      break;\n                    }\n\n                    // get error message from body or default to response statusText\n                    error = data && data.message || response.statusText;\n                    return _context.abrupt(\"return\", Promise.reject(error));\n\n                  case 6:\n                    data.forEach(function (element) {\n                      var txt = _this.stringify(query, element);\n\n                      messages.push({\n                        user: false,\n                        text: txt,\n                        date: new Date()\n                      });\n                    });\n\n                    _this.setState({\n                      messages: messages\n                    });\n\n                    return _context.abrupt(\"return\", data);\n\n                  case 9:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }\n            }, _callee);\n          }));\n\n          return function (_x) {\n            return _ref.apply(this, arguments);\n          };\n        }());\n      } else {\n        reply.forEach(function (element) {\n          messages.push({\n            user: false,\n            text: element,\n            date: new Date()\n          });\n        });\n\n        _this.setState({\n          messages: messages\n        });\n      }\n    };\n\n    _this.state = {\n      messages: [{\n        user: false,\n        text: _this.fixup(\"Hello, How Can I Help You?\"),\n        date: new Date()\n      }],\n      client: {}\n    };\n    _this.analyzer = new ClientAnalysis();\n    _this.debounced_reply = debounce(function (res, q) {\n      return _this.reply(res, q);\n    }, 1000, {\n      'maxWait': 5000\n    });\n    return _this;\n  }\n\n  _createClass(ChatComponent, [{\n    key: \"stringify\",\n    value: function stringify(query, object) {\n      var txt = \"\";\n      Object.keys(object).forEach(function (element) {\n        txt += object[element] + \",\";\n      });\n      return txt;\n    }\n  }, {\n    key: \"fixup\",\n    value: function fixup(text) {\n      // Hack fix for weird \"?\" spacing in elizabot\n      return text.replace(/ \\?/g, '?');\n    }\n    /*\n            <div full-width='full-width' padding-top=\"0\">\n              {JSON.stringify(this.state.client)}\n            </div>*/\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"chatApp\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(Header, {\n        className: \"chatHeader\",\n        as: \"h3\",\n        block: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 9\n        }\n      }, \"Chat with Morty!\"), /*#__PURE__*/React.createElement(Comment.Group, {\n        className: \"chatBody\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(ChatHistory, {\n        messages: this.state.messages,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(ChatInput, {\n        inputHandler: this.handleInput,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 11\n        }\n      })));\n    }\n  }]);\n\n  return ChatComponent;\n}(Component);\n\nexport default ChatComponent;","map":{"version":3,"names":["React","Component","Comment","Header","ChatHistory","ChatInput","ClientAnalysis","debounce","ChatComponent","props","handleInput","input","trim","messages","state","slice","client","analyzer","analyze_question","fixup","push","user","text","date","Date","setState","debounced_reply","Answer","reply","query","length","console","log","changed","fetch","then","response","json","data","ok","error","message","statusText","Promise","reject","forEach","element","txt","stringify","res","q","object","Object","keys","replace"],"sources":["/home/pedromarques27/Desktop/IntelligentSystems/mini-project/react_website/src/ChatComponent.js"],"sourcesContent":["import React, { Component } from 'react';\nimport { Comment, Header } from 'semantic-ui-react';\n\nimport ChatHistory from './ChatHistory'\nimport ChatInput from './ChatInput'\nimport ClientAnalysis from './ComponentAnalysis'\n\nimport debounce from 'lodash.debounce';\nclass ChatComponent extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      messages: [{\n        user: false,\n        text: this.fixup(\"Hello, How Can I Help You?\"),\n        date: new Date(),\n      }],\n      client: {}\n    };\n    this.analyzer = new ClientAnalysis()\n\n    this.debounced_reply = debounce(((res,q) => this.reply(res,q)), 1000, { 'maxWait': 5000 });\n  }\n\n\n\n\n  handleInput = (input) => {\n    input = input.trim();\n\n\n    if (!input)\n      return;\n\n    var messages = this.state.messages.slice(0);\n    var client = this.analyzer.analyze_question(this.fixup(input))\n\n    messages.push({\n      user: true,\n      text: input,\n      date: new Date(),\n    });\n    this.setState({\n      messages,\n      client\n    });\n    this.debounced_reply(client.Answer, client['Query']);\n  }\n\n\n  reply = (reply, query) => {\n    const messages = this.state.messages.slice(0);\n    if (this.state.messages.length === 0)\n      return;\n    console.log(reply, query)\n    if (query){\n      messages.push({\n        user: false,\n        text: \"Don't worry, we're processing your request!\",\n        date: new Date(),\n      });\n      this.setState({\n        messages,\n      });\n      var changed = false;\n      fetch('http://localhost:3009/api?query='+query)\n      .then(async response => {\n          const data = await response.json();\n\n          // check for error response\n          \n          if (!response.ok) {\n            // get error message from body or default to response statusText\n            const error = (data && data.message) || response.statusText;\n\n                       \n            return Promise.reject(error);\n        }\n          data.forEach(element => {\n\n            var txt = this.stringify(query, element)\n            messages.push({\n              user: false,\n              text: txt,\n              date: new Date(),\n            });\n          })\n          this.setState({\n            messages,\n          });\n          return data\n          //attraction_type(A,B)\n      })\n        \n      \n      \n    }else{\n      reply.forEach(element => {\n        messages.push({\n          user: false,\n          text: element,\n          date: new Date(),\n        });\n      })\n      this.setState({\n        messages,\n      });\n    }\n      \n    \n  \n  }\n\n  stringify(query, object){\n    var txt = \"\"\n    Object.keys(object).forEach(element=>{\n      txt+= object[element]+\",\"\n    })\n   \n    \n    return txt\n\n  }\n\n  fixup(text) {\n    // Hack fix for weird \"?\" spacing in elizabot\n    return text.replace(/ \\?/g, '?');\n  }\n/*\n        <div full-width='full-width' padding-top=\"0\">\n          {JSON.stringify(this.state.client)}\n        </div>*/\n  render() {\n    return (\n      <div className=\"chatApp\">\n        \n        <Header className=\"chatHeader\" as='h3' block>\n          Chat with Morty!\n        </Header>\n        <Comment.Group className=\"chatBody\">\n          <ChatHistory messages={this.state.messages} />\n          <ChatInput inputHandler={this.handleInput} />\n        </Comment.Group>\n      </div>\n\n    );\n  }\n}\n\nexport default ChatComponent;"],"mappings":"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"},"metadata":{},"sourceType":"module"}